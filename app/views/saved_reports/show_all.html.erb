<% content_for :titulo_pagina do %>Mis Reportes<% end %>
<% content_for :javascript do %>
<%= javascript_include_tag "http://code.jquery.com/jquery-1.7.min.js" %>
<script type="text/javascript">jQuery.noConflict();</script>
<%= javascript_include_tag "highcharts", "modules/exporting", "highcharts_graficar" %>
<script type="text/javascript">

function graficar(id, query_string) {
	var chart = new Highcharts.Chart({
		chart: {
			renderTo: 'chart_' + id 
		},
		title: { 
			text: null 
		},
		credits: {
			enabled: false
		},
		exporting: {
			enabled: false
		}
	});
	
	chart.showLoading();

	jQuery.ajax({
		url: "/prices/search",
		data: query_string,
		cache: false,
		statusCode: {
			200: function(data) {
				data_graficos[id] = data;
				get_promos(id, query_string, true);
			},
			400: function() {
				alert('Error 400!');
			}
		}
	});
}

jQuery(window).load(function() {
	<% @saved_reports.each_with_index do |sr, i| %>
	<% next unless sr.querystring.include?('currency=' + @currency_id.to_s) %>
		graficar(<%=i%>, '<%=sr.querystring%>');
	<% end %>
});
</script>
<% end %>
<h1>Reportes</h1>
<div style="width: 800px;">
<% @saved_reports.each_with_index do |sr, i| %>
<% next unless sr.querystring.include?('currency=' + @currency_id.to_s) %>
	<div id="id_<%=i%>" style="width: 400px; height: 450px; float: left;">
		<div id="chart_<%=i%>"></div>
	</div>
<% end %>
</div>